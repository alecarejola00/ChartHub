<br>
<div class="company-detail">
  <h1 class="center-text">{{ companyName }} </h1>
  <h3 class="center-text">{{ companySymbol }} </h3>
</div>
<div style="position: relative; width: 100%; height: 400px;">
  <div *ngIf="loadingChart" class="spinner-container" style="position: absolute; inset: 0; display:flex; justify-content:center; align-items:center; background: rgba(255,255,255,0.7); z-index: 10;">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
  <div #chartContainer style="width: 100%; height: 100%;"></div>
  <div #tooltip class="custom-tooltip" style="position: absolute; display: none; background-color: white; border: 1px solid gray; padding: 8px; font-size: 12px; z-index: 1000;"></div>
</div>
<div
  *ngIf="crosshairData.visible"
  class="ohlc-info"
  [ngStyle]="{
    top: (crosshairData.y ?? 0) + 'px',
    left: (crosshairData.x ?? 0) + 'px'
  }"
>
  <strong>{{ crosshairData.time }}</strong><br />
  Open: ₱{{ crosshairData.open }}<br />
  High: ₱{{ crosshairData.high }}<br />
  Low: ₱{{ crosshairData.low }}<br />
  Close: ₱{{ crosshairData.close }}
</div>
<br><br>
<div class="toggle-wrapper">
  <div class="toggle-buttons">
    <button
      mat-raised-button
      *ngFor="let range of timeRanges"
      [ngClass]="{ 'selected-toggle': selectedRange === range.value }"
      (click)="setTimeRange(range.value)">{{ range.label }}
    </button>
  </div>
</div>


<div class="container">
  <br />
<!-- Section 1: Download CSV -->
<div class="button-container center-text">
  <button mat-raised-button color="primary" (click)="downloadCSV()">
    Download CSV for {{ companyName }}
  </button>
</div>

<!-- Section 2: Main Prediction Card with Swappable Thumbnails -->
<div class="prediction-wrapper">
  <!-- Main Card -->
  <div class="main-card">
    <span matTooltipPosition="above" matTooltip="This model is trained to predict closing price starting January 1, 2020 up to April 30, 2025">
      <img [src]="selectedImage!.src" [alt]="selectedImage!.title" />      
    </span>
    <span matTooltip="Type of Machine Learning Model" matTooltipPosition="above">
      <h2 class="center-text">{{ selectedImage?.title }}</h2>
      </span>
    <div class="center-text"></div>
    
    <div class="metrics-container center-text" *ngIf="selectedImage">
      <!-- RMSE -->
      <div class="metric-item">
        <div class="metric-value">
          <strong>RMSE:</strong> {{ selectedImage.rmse }}
        </div>
        <div class="metric-label">
          {{ rmseLabel }}
        </div>
        <div class="metric-description">
          Root Mean Square Error – measures average error magnitude. Lower is better.
        </div>
      </div>

      <!-- MAE -->
      <div class="metric-item">
        <div class="metric-value">
          <strong>MAE:</strong> {{ selectedImage.mae }}
        </div>
        <div class="metric-label">
          {{ maeLabel }}
        </div>
        <div class="metric-description">
          Mean Absolute Error – average absolute difference between predicted and actual values. Lower is better.
        </div>
      </div>

      <!-- R² -->
      <div class="metric-item">
        <div class="metric-value">
          <strong>R²:</strong> {{ selectedImage.r2 }}
        </div>
        <div class="metric-label">
          {{ r2Label }}
        </div>
        <div class="metric-description">
          R-squared – how well the model explains the variance in data. Closer to 1 is better; negative means the model isn't fit.
        </div>
      </div>
    </div>
  </div>

  <!-- Thumbnail Cards -->
  <div class="thumbnail-cards">
    <div 
      class="thumb-card" 
      *ngFor="let image of filteredPredictionImages" 
      (click)="swapImage(image)"
    >
      <img [src]="image.src" [alt]="image.title" />
      <h3>{{ image.title }}</h3>
    </div>
  </div>
</div>

